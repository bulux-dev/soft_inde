<div class="content">
  <div class="page-header">
    <div class="page-title">
      <h4>Kitchen Display</h4>
      <h6>Control de cuentas</h6>
    </div>
    <div class="page-btn">
      <!-- <button class="btn btn-added" data-bs-toggle="offcanvas" data-bs-target="#agregar-comercio"
        permiso="agregar-comercio">
        <i class="fa fa-plus me-2"></i>
        Agregar Comercio
      </button> -->
    </div>
  </div>

  <ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button (click)="view = 'comandas'" (click)="getComandas()"  class="nav-link active" id="comandas-tab" data-bs-toggle="tab" data-bs-target="#comandas" type="button"
        role="tab" aria-controls="comandas" aria-selected="true">Comandas</button>
    </li>
    <li class="nav-item" role="presentation">
      <button (click)="view = 'cuentas'" (click)="getCuentas()"  class="nav-link" id="cuentas-tab" data-bs-toggle="tab" data-bs-target="#cuentas" type="button" role="tab"
        aria-controls="cuentas" aria-selected="false">Cuentas</button>
    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="comandas" role="tabpanel" aria-labelledby="comandas-tab">
      <div class="row">
        @for (c of comandas; track c) {
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">
              <div class="row">
                <div class="col-6">
                  <p class="mb-0" style="font-weight: 900 !important;">
                    {{c.cuenta.estacion.area.comercio.nombre}} / {{c.cuenta.estacion.area.nombre}} /
                    {{c.cuenta.estacion.nombre}}
                  </p>
                  <h5 class="card-title mb-0 text-primary">{{c.serie}}-{{c.correlativo}}</h5>
                </div>
                <div class="col-6 text-end">
                  <span class="badge bg-primary" style="font-size: 15px;">{{ fromNow(c.fecha) }}</span>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Descripcion</th>
                      <th class="text-end">Comentario</th>
                      <th class="text-end">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (d of c.comandas_detalles; track d) {
                    <tr [ngClass]="{'table-success': d.finalizado}">
                      <td>{{d.cantidad}} {{d.descripcion}}</td>
                      <td class="text-end">{{d.comentario}}</td>
                      <td class="text-end">
                        <button class="btn btn-primary btn-sm" (click)="setFinalizado(d)">
                          <i class="fas fa-check"></i>
                        </button>
                      </td>
                    </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
    <div class="tab-pane fade" id="cuentas" role="tabpanel" aria-labelledby="cuentas-tab">
      <div class="row">
        @for (c of cuentas; track c) {
        <div class="col-lg-4">
          <div class="card flex-fill bg-white">
            <div class="card-header">
              <div class="row">
                <div class="col-6">
                  <p class="mb-0" style="font-weight: 900 !important;">
                    {{c.estacion.area.comercio.nombre}} / {{c.estacion.area.nombre}} / {{c.estacion.nombre}}
                  </p>
                  <h5 class="card-title mb-0 text-primary">{{c.nombre}}</h5>
                </div>
                <div class="col-6 text-end">
                  <span class="badge bg-primary" style="font-size: 15px; margin-right: 5px;">{{ fromNow(c.comandas[0].fecha) }}</span>
                  <a class="btn btn-primary btn-sm"
                    [attr.href]="'/admin/comandas/comercios/' + c.estacion.area.comercio_id + '/area/' + c.estacion.area_id + '/estacion/' + c.estacion_id + '/cuenta/' + c.id"
                    target="_blank" style="margin-right: 5px;">
                    <i class="fas fa-receipt"></i>
                  </a>
                  @if(getTotalCuenta(c) == 0) {
                  <button class="btn btn-danger btn-sm" (click)="deleteCuenta(c)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                  }
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Descripcion</th>
                      <th class="text-end">Precio</th>
                      <th class="text-end">Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (co of c.comandas; track co) {
                    <ng-container *ngIf="co.comandas_detalles.length > 0">
                      <tr style="background: rgb(232, 232, 232);">
                        <td class="text-primary text-center bg-gray" colspan="3">{{co.serie}}-{{co.correlativo}}</td>
                      </tr>
                      @for (d of co.comandas_detalles; track d) {
                      <tr [ngClass]="{'table-success': d.finalizado}">
                        <td>{{d.cantidad}} {{d.descripcion}}</td>
                        <td class="text-end">{{d.total | moneda: 'Q. '}}</td>
                        <td class="text-end">
                          @if(!d.finalizado) {
                          <button class="btn btn-primary btn-sm" (click)="setFinalizado(d)">
                            <i class="fas fa-check"></i>
                          </button>
                          }
                        </td>
                      </tr>
                      }
                    </ng-container>
                    }

                  </tbody>
                  <tfoot>
                    <tr>
                      <td class="text-end">Total</td>
                      <td class="text-end">{{getTotalCuenta(c) | moneda: 'Q. '}}</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>